(()=>{"use strict";class t{constructor(t){this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}setEventListeners(){this._popup.addEventListener("mousedown",(t=>{t.target.classList.contains("popup__overlay")&&this.close(),t.target.classList.contains("popup__close-button")&&this.close()}))}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(t){"Escape"===t.key&&this.close()}}class e extends t{constructor(t,e){super(t),this._formSubmit=e,this._form=this._popup.querySelector(".form"),this._inputList=Array.from(this._popup.querySelectorAll(".popup__input")),this._submitButton=this._popup.querySelector(".popup__submit-button")}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(t=>this._formSubmit(t,this._getInputValues())))}close(){super.close(),this._form.reset()}setInputValues(t){this._inputList.forEach((e=>{e.value=t[e.name]}))}setButtonName(t){this._submitButton.value=t}_getInputValues(){return this._formValues={},this._inputList.forEach((t=>this._formValues[t.name]=t.value)),this._formValues}}const s=document.querySelector(".profile__edit-button"),i=document.querySelector(".profile__name"),r=document.querySelector(".profile__subtitle"),n=document.querySelector(".elements__list"),o=document.querySelector(".profile__add-button"),a=document.querySelector("#card-template").content,c=document.querySelector(".profile__avatar-hover"),h=document.querySelector(".profile__avatar"),_=new class{constructor(t){let{baseUrl:e,headers:s}=t;this._baseUrl=e,this._fetchObject={},this._fetchObject.headers=s,this._fetchObject.method="GET"}getUserInfo(){return this._checkResponse(fetch(`${this._baseUrl}/users/me`,this._fetchObject))}getInitialCards(){return this._checkResponse(fetch(`${this._baseUrl}/cards`,this._fetchObject))}editUserInfo(t,e){return this._fetchObject.method="PATCH",this._fetchObject.body=JSON.stringify({name:t,about:e}),this._checkResponse(fetch(`${this._baseUrl}/users/me`,this._fetchObject))}addCard(t){let{name:e,link:s}=t;return this._fetchObject.method="POST",this._fetchObject.body=JSON.stringify({name:e,link:s}),this._checkResponse(fetch(`${this._baseUrl}/cards`,this._fetchObject))}deleteCard(t){return this._fetchObject.method="DELETE",this._checkResponse(fetch(`${this._baseUrl}/cards/${t}`,this._fetchObject))}pressLike(t){return this._fetchObject.method="PUT",this._checkResponse(fetch(`${this._baseUrl}/cards/${t}/likes`,this._fetchObject))}deleteLike(t){return this._fetchObject.method="DELETE",this._checkResponse(fetch(`${this._baseUrl}/cards/${t}/likes`,this._fetchObject))}changeAvatar(t){return this._fetchObject.method="PATCH",this._fetchObject.body=JSON.stringify({avatar:t}),this._checkResponse(fetch(`${this._baseUrl}/users/me/avatar`,this._fetchObject))}_checkResponse(t){return t.then((t=>{if(t.ok)return t.json();console.log(`Ошибка: ${t.status}`)}))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-64",headers:{authorization:"8e64748d-eef9-4a6a-8486-bec99847cca5","Content-Type":"application/json"}});let l;const u={},d=new class{constructor(t,e){let{renderer:s}=t;this._renderer=s,this._container=e}addItem(t){this._container.prepend(t)}renderItems(t){t.forEach((t=>{this._renderer(t)}))}}({renderer:t=>{const e=E(t);d.addItem(e)}},n),p=new class{constructor(t){let{name:e,description:s,avatar:i}=t;this._name=e,this._description=s,this._avatar=i}getUserInfo(){return{"edit-name":this._name.textContent,"edit-profession":this._description.textContent}}setUserInfo(t){let{name:e,about:s}=t;this._name.textContent=e,this._description.textContent=s}setAvatar(t){let{avatar:e}=t;this._avatar.src=e}}({name:i,description:r,avatar:h}),m=new e(".edit-popup",(async function(t,e){t.preventDefault();const s=e["edit-name"],i=e["edit-profession"];try{m.setButtonName("Сохранение..."),await _.editUserInfo(s,i),p.setUserInfo.bind(p)({name:s,about:i}),m.close()}catch(t){console.log(`Ошибка: ${t.message}`)}finally{m.setButtonName("Сохранить")}}));m.setEventListeners();const f=new e(".new-card-popup",(async function(t,e){t.preventDefault();const s={link:e["new-card-image"],name:e["new-card-name"]};try{f.setButtonName("Создание...");const t=E(await _.addCard(s));d.addItem(t),S(),f.close()}catch(t){console.log(`Ошибка: ${t.message}`)}finally{f.setButtonName("Создать")}}));f.setEventListeners();const v=new class extends t{constructor(t){super(t),this._popupImage=this._popup.querySelector(".image-popup__image"),this._popupTitle=this._popup.querySelector(".image-popup__title")}open(t,e){super.open(),this._popupImage.src=e,this._popupImage.alt=t,this._popupTitle.textContent=t}}(".image-popup");v.setEventListeners();const b=new class extends t{constructor(t){super(t),this._deleteButton=this._popup.querySelector(".popup__submit-button")}open(t){super.open(),this._removeCard=t}setEventListeners(){super.setEventListeners(),this._deleteButton.addEventListener("click",(()=>this._removeCard()))}setButtonName(t){this._deleteButton.textContent=t}}("#delete-popup");b.setEventListeners();const L=new e("#avatar-popup",(async function(t,e){let{avatarInput:s}=e;t.preventDefault();try{L.setButtonName("Сохранение..."),await _.changeAvatar(s),p.setAvatar({avatar:s}),L.close()}catch(t){L.setButtonName(`Ошибка: ${t.message}`)}finally{L.setButtonName("Сохранить")}}));function E(t){return new class{constructor(t,e,s,i,r,n,o){let{link:a,name:c,_id:h,likes:_,owner:l}=t;this._cardName=c,this._cardLink=a,this._cardTemplate=e,this._handleCardClick=s,this._checkCardsQuantity=i,this._cardId=h,this._likes=_,this._likeHandler=o,this._userId=r,this._owner=l,this._openDeletePopup=n}render=()=>(this._createCard(),this._card);renderLikes(t){this._likeCounter.textContent=t.length;const e=t.some((t=>t._id===this._userId));this._cardLikeButton.classList.toggle("card__like-button_active",e)}_setEventListeners=()=>{this._cardImage.addEventListener("click",(()=>this._handleCardClick(this._cardName,this._cardLink))),this._cardLikeButton.addEventListener("click",this._handleLikeButton);const t=this._cardRemover.bind(this);this._cardDeleteButton.addEventListener("click",(()=>this._openDeletePopup(t,this._cardId)))};_cardRemover(){this._card.remove(),console.log(this._card),this._checkCardsQuantity()}_handleLikeButton=t=>{this._likeHandler(t,this,this._cardId)};_getCard=()=>this._cardTemplate.querySelector(".card").cloneNode(!0);_createCard=()=>{this._card=this._getCard(),this._cardLikeButton=this._card.querySelector(".card__like-button"),this._cardDeleteButton=this._card.querySelector(".card__delete-button"),this._renderDeleteIcon(),this._card.querySelector(".card__name").textContent=this._cardName,this._cardImage=this._card.querySelector(".card__image"),this._cardImage.src=this._cardLink,this._cardImage.alt=this._cardName,this._likeCounter=this._card.querySelector(".card__like-counter"),this.renderLikes(this._likes),this._setEventListeners()};_renderDeleteIcon(){this._owner._id!==this._userId&&this._cardDeleteButton.classList.add("card__delete-button_disabled")}}(t,a,g,S,l,y,k).render()}async function k(t,e,s){try{if(t.target.classList.contains("card__like-button_active")){const t=await _.deleteLike(s);e.renderLikes(t.likes)}else{const t=await _.pressLike(s);e.renderLikes(t.likes)}}catch(t){console.log(t)}}function y(t,e){b.open((async()=>{try{b.setButtonName("Удаление..."),await _.deleteCard(e),t(),b.close()}catch(t){console.log(t)}finally{b.setButtonName("Да")}}))}function g(t,e){v.open(t,e)}function S(){n.children.length<3?n.classList.add("elements__list_few-cards"):n.classList.remove("elements__list_few-cards")}L.setEventListeners();var C;s.addEventListener("click",(()=>{u.profileEdit.resetValidation();const t=p.getUserInfo();m.setInputValues(t),m.open()})),o.addEventListener("click",(()=>{u["new-card"].resetValidation(),f.open()})),c.addEventListener("click",(()=>{u.avatar.resetValidation(),L.open()})),C={formSelector:".form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputError:"input__error",inputErrorText:"input__error-text"},Array.from(document.querySelectorAll(C.formSelector)).forEach((t=>{const e=new class{constructor(t,e){this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputError=t.inputError,this._inputErrorText=t.inputErrorText,this._form=e}enableValidation=()=>{this._form.addEventListener("submit",(t=>{t.preventDefault()})),this._setEventListeners()};resetValidation=()=>{this._toggleButtonState(!0),this._inputList.forEach((t=>{t.value="",this._hideError(t)}))};_setEventListeners=()=>{this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector)),this._submitButton=this._form.querySelector(this._submitButtonSelector),this._toggleButtonState(),this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._checkInputValidity(t),this._toggleButtonState()}))}))};_toggleButtonState=t=>{this._hasInvalidInput()||t?(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.setAttribute("disabled",!0)):(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.removeAttribute("disabled",!0))};_hasInvalidInput=()=>this._inputList.some((t=>!t.validity.valid));_checkInputValidity=t=>{t.validity.valid?this._hideError(t):this._showError(t,t.validationMessage)};_showError=(t,e)=>{const s=this._form.querySelector(`#error__${t.name}`);t.classList.add(this._inputError),s.textContent=e,s.classList.add(this._inputErrorText)};_hideError=t=>{const e=this._form.querySelector(`#error__${t.name}`);t.classList.remove(this._inputError),e.textContent="",e.classList.remove(this._inputErrorText)}}(C,t),s=t.getAttribute("name");u[s]=e,e.enableValidation()})),Promise.all([_.getUserInfo(),_.getInitialCards()]).then((t=>{let[e,s]=t;var i;(t=>{p.setAvatar(t),p.setUserInfo(t),l=t._id})(e),i=s,d.renderItems(i),S()})).catch((t=>console.log(t)))})();
//# sourceMappingURL=main.03f1da1de61b0fe09f16.bundle.js.map